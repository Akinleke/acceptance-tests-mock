# **testrail-test-automation-framework**

## **Pre-Requisites**
- Config file located in `src/config`
  
  Change variables as needed. **Example**:

```javascript
export default {
    "testRailProjectName": "Playground",
    "testRailRegressionSuiteName": "AddressLookupRegression",
    "testRailSuiteName": "Sprint21",
    "testRailSectionName": "Sprint21",
    "testRailHost": "https://coveainsurance.testrail.io/index.php?/api/v2",
    "URLforTestEnv": "http://localhost:3000",
    "regressionRun": true
  }
```
> - ***testRailProjectName*** - Manually create a Project in TestRail and add the name to the config
> - ***testRailRegressionSuiteName*** - Enter any name for the Regression Suite (_this will be created if it does not exist_)
> - ***testRailSuiteName*** - Enter any name for the Sprint Suite (_this will be created if it does not exist_)
> - ***testRailSectionName*** - Should be the same name as Sprint Suite (_this will be created if it does not exist_)
> - ***testRailHost*** - URL for TestRail
> - ***URLforTestEnv*** - URL for test environment
> - ***regressionRun*** - If set to `true`, regression results will be added to TestRail

- Create an .env file in the root folder for TestRail credentials. Add the following:

```
TESTRAIL_USERNAME = email.name@coveainsurance.co.uk
TESTRAIL_APIKEY = APIKey (create via TestRail UI)
```

- Install dependencies from package.json
```
npm install
```
- Run commands
```
// To run the JSON server (if running locally)
npm run server

// To run the cucumber tests with no report
npm run test-no-report
```

## **Folder Structure**

### TestRail Template

```
├── _node_modules
|     ├── .bin...   
├── _src
      ├── _config
            ├── config.ts
      ├── _utils
            ├── testRail.ts
            ├── testRailHandler.ts
├── _test
|     ├── features
|     ├── hooks
|     ├── models
|     ├── report
|     └── steps
├── .env
├── .gitignore
├── .npmrc
├── package.json
├── tsconfig.json
```

## **TestRail files/functions**

`testRail.ts` contains the required functions for interacting with the TestRail API. Eg. GetSuite, AddSuite, AddResultForCase, etc

`testRailHandler.ts` contains the logic which determines whether the Suite or Run already exists

`hooks.ts` contains the BeforeAll, Before and After hooks that run respectively around each of the Cucumber scenarios

## **TestRail Process**
In the `BeforeAll` hook, the **ProjectId**, **SprintSuiteId** and **RegressionSuiteId** are retrieved (*SprintSuiteId* and *RegressionSuiteId* are created if they do **not** exist).

The **RunId** is also retrieved. This is required for adding the results to TestRail. The **RunId** is created if it does not already exist.

Every test run uses the same **RunId**. The history of the TestCase shows the Passes/Failures in the TestRail UI.

In the `Before` hook, the CaseIds for the Sprint and Regression Suites are added. The `Before` function contains the `params` from Cucumber to send the Test Case name, Id, etc.

In the `After` hook, will add the results for each test to TestRail. The function parameter is information from Cucumber which shows the 'Passed' or 'Failed' status. The result is added according to whether the test is within the Sprint or part of the Regression. The previously retrieved *RunId* is also used in this instance.